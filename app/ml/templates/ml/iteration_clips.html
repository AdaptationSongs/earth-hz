{% extends 'audio-player.html' %}
{% from 'bootstrap/form.html' import render_form %}
{% from 'bootstrap/pagination.html' import render_pagination %}


{% block app_content %}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('projects.overview', project_id=iteration.model.project.id) }}">{{ iteration.model.project.name }}</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('ml.list_models', project_id=iteration.model.project.id) }}">Machine Learning Models</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('ml.list_iterations', model_id=iteration.model.id) }}">{{ iteration.model.name }}</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('ml.view_iteration', iteration_id=iteration.id) }}">{{ iteration.updated }}</a></li>
      <li class="breadcrumb-item active">Labeled clips</li>
    </ol>
  </nav>
  {{ render_form(filter_form, method='get', form_type='inline') }}
  {% if labeling %}
    <p>
      {{ render_form(use_form, method='post', form_type='inline', extra_classes='d-inline-block', button_map={'use': 'success', 'do_not_use': 'danger'}) }} these {{ clips_count }} clips for training
    </p>
  {% endif %}
  {% for clip in clips.items %}
    <div class="card mt-3 mb-3">
      <div class="card-body row">
        <div class="col-md-6">
          <a class="btn btn-primary" href="javascript:void(0)" onclick="playClip('{{ clip.file.name }}', '{{ clip.offset }}')">Play clip</a>
          <h5 class="card-title">{{ clip.label.name }}{% if not clip.certain %} (maybe){% endif %}</h5>
          <p class="card-text">Start time: {{ clip.start_time() }}</p>
          <p class="card-text">Monitoring Station: {{ clip.file.monitoring_station.name }}</p>
          <p class="card-text">Recording device: {{ clip.file.sn }}</p>
          <p class="card-text">submitted by {{ clip.user }} on {{ clip.modified }}</p>
          <p><a class="btn btn-primary" href="{{ url_for('labels.view_clip', file_name=clip.file.name, offset=clip.offset) }}">Edit Labels</a></p>
          <div id="use-block-{{ loop.index }}" data-clip-id="{{ clip.id }}"></div>
        </div>
        <div class="col-md-6">
          <img class="card-img-top" src="{{ url_for('audio.spectro', file_name=clip.file_name, offset=clip.offset) }}">
        </div>
      </div>
    </div>
  {% endfor %}
  {{ render_pagination(clips) }}
{% endblock %}

{% block scripts %}
    {{super()}}
    <script>
      for (i = 1; i <= {{ clips.items | length }}; i++) {
        const block = document.getElementById('use-block-' + i);
        const props = {
          iteration_id: {{ iteration.id }},
          clip_id: block.getAttribute('data-clip-id'),
          disabled: {{ (not labeling) | tojson }},
        };
        ReactDOM.render(
          React.createElement(EarthHz.UseClip, props, null),
          block
        );
      }
    </script>
{% endblock %}
